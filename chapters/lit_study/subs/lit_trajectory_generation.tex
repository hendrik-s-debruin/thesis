\section{Trajectory Generation}%
\label{sec:trajectory_generation}

	The problem of trajectory generation can be categorised into one-dimensional
	and multi-dimensional trajectories. Techniques exist to generate
	point-to-point trajectories, as well as to generate trajectories that visit
	multiple points. The latter case can be further subdivided into trajectories
	that visit each point exactly (known as interpolation techniques) and
	trajectories that come within a specified tolerance of each point (know as
	approximation techniques). \todo{maybe cite trajectory book p 2 here}
	\todo{maybe give image representation of categories?}

	One-dimensional trajectories can often be generalised for the
	multi-dimensional case. As such,
	Section~\ref{sec:one_dimensional_trajectory_generation} gives an overview of
	such techniques. Section~\ref{sec:multi_dimensional_trajectory_generation}
	gives an overview of trajectory generation techniques that are directly
	suited for the multi-dimensional case. Finally, trajectories may be subject
	to constraints on maximum velocity, acceleration, jerk, or higher
	derivatives.  Section~\ref{sec:trajectory_scaling} reviews methods to deal
	such constraints.

	\subsection{One Dimensional Trajectory Generation}%
	\label{sec:one_dimensional_trajectory_generation}

		There are several elementary trajectories that can be used to obtain a
		desired one-dimensional behaviour. Trajectories can also be added
		together to satisfy some other constraints. \todo{describe better}

		\todo{Discuss need for continuity in position profile and its
		derivatives up to a given order, need for boundary conditions. See
		notes, section 2.4}

		\subsubsection{Elementary Trajectories}%
		\label{sec:elementary_trajectories}

			\paragraph{Polynomial Trajectories}%
			\label{sec:polynomial_trajectories}

				Given the boundary conditions in position, velocity,
				acceleration, jerk, or higher derivatives for $\timesym \in
				\{\timesym_0, \timesym_{\final}\}$, a polynomial of higher
				degree can be fitted to satisfy the conditions. \todo{wording}
				\todo{what is the minimum degree?}

				We can write the normalised polynomial as:

				\begin{equation}
					\configuration(\timenorm) = \sum_{\indexi=0}^{\poldeg}
						\coefficient_{\indexi} \timenorm^{\indexi}
				\end{equation}

				This may be rewritten in matrix form as follows:

				\begin{equation}
					\mat{M}\vec{\coefficient} = \vec{b}
					\label{eq:polynomial_coefficient_equation}
				\end{equation}
				\todo{put these symbols into the nomenclature}

				Where the coefficients to be solved are put into
				\(
					\vec{\coefficient} =
						{
							\left[
								\begin{matrix}
									\coefficient_0 &
									\cdots &
									\coefficient_{\poldeg}
								\end{matrix}
							\right]
						}^T
				\),
				the boundary conditions are
				\(
					\vec{b} =
						{
							\left[
								\begin{matrix}
									\configuration_0 &
									\dot{\configuration}_0 &
									\cdots &
									\tdern{\configuration_0}{n} &
									\configuration_{\final} &
									\dot{\configuration}_{\final} &
									\cdots &
									\tdern{\configuration_{\final}}{n}
								\end{matrix}
							\right]
						}^T
				\)
				and $\mat{M}$ is filled using the boundary conditions of the
				polynomial.

				In principle, we can then simply obtain the trajectory by
				setting

				\begin{equation}
					\vec{\coefficient} = {\mat{M}}^{-1}\vec{b}
				\end{equation}

				However, taking the inverse of a matrix explicitly like this can
				lead to numerical instability even for a low degree polynomial.
				Other numerical techniques should be used for poorly conditioned
				matrices. \todo{either explain one (p 41 ish), or say where to
				get it}

			\paragraph{Trigonometric Trajectories}%
			\label{trigonometric_trajectories}

				Several types of trajectories can be generated by using
				trigonometric functions. Such trajectories have the advantage
				that they are of type
				\(
					\contdeg{\infty}
				\), with non-zero derivatives
				\(
					\forall \timenorm \in [0, 1]
				\).
				If proper care is taken in defining the boundary conditions,
				these trajectories can be used for continuous cyclic motions.
				\todo{fix continuity degree in nomenclature definition}

				\todo{change layout here}
				\todo{maybe normalise the equations}
				\begin{itemize}

					\item %HARMONIC

						Harmonic Trajectories are designed such that the
						acceleration of the trajectory is proportional to its
						position. Such trajectories are expressed by:

						\begin{equation}
							\configuration(\timesym) =
								\frac{%
										\configuration_{\final} - \configuration_0
									}
									{%
										2
									}
								\left(
									1 - \cos
										\frac{%
												\pi(\timesym - \timesym_0)
											}
											{%
												\timesym_{\final} - \timesym_0
											}
								\right)
								+ \configuration_0
						\end{equation}

						Note that this trajectory is discontinuous in its
						acceleration profile at the boundaries.

					\item %ELLIPTICAL

						Elliptical trajectories are a generalised form of
						harmonic trajectories.  They are of the following form:

						\begin{equation}
							\configuration(\timesym) =
								\frac
								{%
									\configuration_{\final} - \configuration_0
								}
								{%
									2
								}
								\left(
									1 -
									\frac
									{%
										\cos\frac
											{%
												\pi(\timesym - \timesym_0)
											}
											{%
												\timesym_{\final} - \timesym_0
											}
									}
									{%
										\sqrt
										{%
											1 -
											\frac
											{%
												n^2 - 1
											}
											{%
												n^2
											}
											\sin^2\frac
											{%
												\pi(\timesym - \timesym_0)
											}
											{%
												\timesym_{\final} - \timesym_0
											}
										}
									}
								\right)
						\end{equation}
						\todo{$n$ here is not in nomenclature}

						Here, $n$ may be tuned. Higher values of $n$ lead to
						higher values maxima in the time derivatives of
						position.
						\todo{what is the point of this trajectory?}
						\todo{explain why I call it time derivatives of
						position, and not acceleration etc.}

					\item %CYCLOIDAL

						Cycloidal trajectories obtain a continuous acceleration
						profile
						\(
							\forall \timesym \in [\timesym_0, \timesym_{\final}]
						\).
						These are given by the expression:

						\begin{equation}
							\configuration(\timesym) =
								(\configuration_{\final} - \configuration_0)
								\left(
									\frac
									{%
										\timesym - \timesym_0
									}
									{%
										\timesym_{\final} - \timesym_0
									}
									-
									\frac
									{%
										1
									}
									{%
										2\pi
									}
									\sin
										\frac
										{%
											2\pi(\timesym - \timesym_0)
										}
										{%
											\timesym_{\final} - \timesym_0
										}
								\right)
								+ \configuration_0
						\end{equation}

						Due to the continuous acceleration profile, these
						trajectories are suitable for mechanisms with flexible
						components.

				\end{itemize}

			\paragraph{Exponential Trajectories}%
			\label{exponential_trajectories}

				Exponential trajectories may be constructed such that the
				degree of continuity of the trajectory may be adjusted.
				\todo{quote bookref 14} These trajectories are exponential in
				their velocity profiles, therefore their position profile is
				given by the following expression:

				\begin{equation}
					\configuration(\timenorm) = v_c \int_{0}^{\timenorm}
						e^{-\sigma f(\timenorm, \lambda)} \der \timenorm
				\end{equation}
				\todo{These parameters are not in the nomenclature}

				A popular choice \todo{put reference here} for $f$ is:

				\begin{equation}
					f(\timenorm, \lambda) =
						\frac
						{%
							{(2\timenorm)}^2
						}
						{%
							{%
								\left|
									1 - {(2\timenorm)}^2
								\right|
							}^\lambda
						}
				\end{equation}
				\todo{These parameters are not in the nomenclature}

				$\sigma$ and $\lambda$\todo{nomenclature} may be chosen to
				minimise high frequency components in the acceleration. By
				tuning these parameters, vibrations induced by the trajectory
				can be lowered.

			\paragraph{Trajectories Based on Fourier Series Expansion}%
			\label{trajectories_based_on_fourier_series_expansion}

				Given any of the previous trajectories of this section, one may
				want to attempt to limit vibrations induced by the trajectory.
				One method, which is especially useful for periodic
				trajectories, is the use of Fourier series expansion.

				A trajectory $\configuration(\timesym)$ may be transformed as
				follows:

				\begin{enumerate}

					\item

						Expand $\configuration(\timesym)$ into its Fourier
						series.

					\item

						Take the first $n$ terms of this series and use it to
						define a new trajectory $\configuration'(\timesym)$.
				\end{enumerate}
				\todo{$n$ is not in nomenclature}

				The number of terms, $n$, of the expansion to use compromises a
				trade-off: higher $n$ leads to lower maximum acceleration, but
				higher frequency components. $n$ in this case is a tuning
				parameter.
				\todo{$n$ is not in nomenclature}

		\subsubsection{Trajectory Composition}%
		\label{sec:trajetory_composition}

			Trajectories such as those presented in
			Section~\ref{sec:elementary_trajectories} may be combined to obtain
			new trajectories. The problem is then to smoothly connect these
			trajectories with trajectory segments referred to as
			``bends''.\todo{make sure this sentence is not bullshit}

			Many of the composition techniques break the trajectory into the
			following parts:

			\begin{enumerate}

				\item acceleration phase

				\item trajectory phase

				\item deceleration phase

			\end{enumerate}
			\todo{this list is probably stupid}

			\paragraph{Circular Bends}%
			\label{circular_bends}

				Circular Bends can be added to the position profile of a linear
				trajectory to start the trajectory segment from rest or to bring
				it to rest. Given a base linear trajectory,
				$\configuration(\timesym)$, the full trajectory
				$\configuration'(\timesym)$ is given  by:

				\begin{equation}
					\configuration'(\timesym) =
						\begin{cases}
							(\configuration_{\final} - \configuration_0)
							\left(
								1 - \sqrt
									{%
										1 - \frac
											{%
												{(\timesym - \timesym_0)}^2
											}
											{%
												{(\configuration_{\final} -
												\configuration_0)}^2
											}
									}
							\right)
							+ \configuration_0
							%
							& \timesym \in [\timesym_0, \timesym_a]
							%
							\\
							%
							\configuration(\timesym)
							%
							& \timesym \in [\timesym_a, \timesym_b]
							%
							\\
							%
							\configuration_0 +
								\sqrt
									{%
										{(\configuration_{\final} -
										\configuration_0)}^2
										-
										{(\timesym_{\final} - \timesym)}^2
									}
							%
							& \timesym \in [\timesym_b, \timesym_{\final}]
						\end{cases}
				\end{equation}
				\todo{$a$ and $b$ are not in nomenclature}

				The time intervals must be chosen such that:

				\begin{equation}
					\begin{cases}
						\configuration'(\timesym \in [\timesym_0,
							\timesym_a])|_{\timesym_a}
							=
							\configuration'(\timesym \in [\timesym_a,
								\timesym_b])|_{\timesym_a}
						%
						\\
						%
						\dot{\configuration}'(\timesym \in [\timesym_0,
							\timesym_a])|_{\timesym_a}
							=
							\dot{\configuration}'(\timesym \in [\timesym_a,
								\timesym_b])|_{\timesym_a}
					\end{cases}
				\end{equation}
				\todo{$a$ and $b$ are not in nomenclature}

			\paragraph{Polynomial Bends}%
			\label{polynomial_bends}

				Another method of starting or stopping a trajectory, or of
				joining different trajectory segments, is through the use of
				polynomial bends. The degree of smoothness of the connections
				can be controlled by choosing the degree of the polynomial
				bends. Given a base trajectory, $\configuration(\timesym)$, a
				new trajectory with polynomial bends,
				$\configuration'(\timesym)$ can be defined as follows:

				\begin{equation}
					\configuration'(\timesym) =
					\begin{cases}
						\configuration_a(\timesym) & \timesym \in [\timesym_0, \timesym_a] \\
						\configuration(\timesym) & \timesym \in [\timesym_a, \timesym_b] \\
						\configuration_b(\timesym) & \timesym \in [\timesym_b, \timesym_{\final}] \\
					\end{cases}
					\label{eq:polynomial_bends}
				\end{equation}
				\todo{$a$ and $b$ are not in nomenclature}

				Here, $\configuration_a$ and $\configuration_b$ may be computed
				using the polynomial trajectory method of
				Section~\ref{sec:elementary_trajectories}.

				\todo{for this section, reference bookref 17. The book
				references it on page 117. This section is a combination of
				various sections from the book}

			\todo{maybe add a discussion on the trapezoidal trajectories?}

			\paragraph{Cycloidal and Harmonic Blends}%
			\label{cycloidal_and_harmonic_blends}

				We may also connect trajectory segments with sinusoidal
				profiles described in Section~\ref{sec:elementary_trajectories}.
				The clear advantage of these bends are that they are of type
				$\contdeg{\infty}$.

				Again, the new trajectory $\configuration'(\timesym)$ is given
				by Equation~\ref{eq:polynomial_bends}, where
				$\configuration_a(\timesym)$ and $\configuration_b(\timesym)$
				are now one of the trigonometric functions of
				Section~\ref{sec:elementary_trajectories}.
				\todo{$a$ and $b$ are not in nomenclature}

	\subsection{Multipoint Trajectories}%
	\label{sec:multipoint_trajectories}

		The techniques from
		Section~\ref{sec:one_dimensional_trajectory_generation} are concerned
		with generating trajectories between two points. The present section
		documents methods to generate a trajectory that goes through all the
		points $\point$ in a given set of points $\setofpoints$.

		\todo{Say that there are trajectories which interpolate, as well as
		trajectories which approximate. Todo, write about these}

		\subsubsection{Interpolation Techniques}%
		\label{sec:interpolation_techniques}

			\paragraph{Multipoint Polynomial Trajectories}%
			\label{sec:multipoint_polynomial_trajectories}


				The polynomial method of
				Section~\ref{sec:polynomial_trajectories} can be extended to
				exactly interpolate a set of points. This is done by simply
				adjusting the vector \todo{this vector is not in the
				nomenclature and is the same symbol as used in the other
				polynomial section. If it is added to nomencl there/changed
				there, the same must be done here} $\vec{b}$ to also include the
				intermediate points. A polynomial of degree $\poldeg$ can be
				used to interpolate $\poldeg + 1$ points.

				The main disadvantage is that polynomials tend to overshoot a
				lot between points.

			\paragraph{Trigonometric Polynomials}%
			\label{sec:trigonometric_polynomials}

				Trigonometric polynomials are similar to regular polynomials,
				except they are suitable for periodic motions. By definition,
				these trajectories are of type $\contdeg{\infty}$. They are
				given by the expression:

				\begin{equation}
					\configuration(\timesym) =
						\coefficient_0 +
						%
						\sum_{\indexi = 1}^{\poldeg} \coefficient_{\indexi}
							\cos
							\left(
								\indexi\frac
								{%
									2\pi\timesym
								}
								{%
									\period
								}
							\right)
						%
						+
						%
						\sum_{\indexi = 1}^{\poldeg}\coefficientb_{\indexi}
							\sin
							\left(
								\indexi\frac{%
									2\pi\timesym
								}
								{%
									\period
								}
							\right)
				\end{equation}

				The degree of the polynomial $\poldeg$ is chosen such that
				$\cardinality{\setofpoints} = 2\poldeg + 1$. The coefficients
				are solved using the same method of polynomial trajectories. A
				set of these polynomials may be joined to form a trigonometric
				spline. \todo{ref book ref 27, 28, 29. See p 175}

			\paragraph{Splines}%
			\label{sec:splines}

				$\cardinality{\setofpoints} - 1$ polynomials of degree usually
				set to $\poldeg \leq \cardinality{\setofpoints} - 2$ may be used
				to form a spline interpolation. The main idea is to use each
				polynomial to interpolate between two points. The polynomial
				degree $\poldeg$ and the boundary conditions in
				Equation~\ref{eq:polynomial_coefficient_equation} are then
				chosen to ensure that the splines meet with a desired level of
				continuity.

				A common choice for the degree of the polynomial is $\poldeg =
				3$. This ensures that accelerations remain continuous at the
				transitions. Furthermore, it is easy to set the start and end
				conditions to be continuous up to a required degree in order to
				make the trajectories periodic.

		\subsubsection{Approximation Techniques}%
		\label{sec:approximation_techniques}

			\todo{orthogonal polynomials --- p 165}

			\paragraph{Smoothing Cubic Splines}%
			\label{sec:smoothing_cubic_splines}

				Smoothing cubic splines are an adaptation on the spline
				interpolation of Section~\ref{sec:splines}. They try to have as
				good as possible a fit of the points in $\setofpoints$, yet try
				to limit the curvature of the trajectory. This tends to reduce
				the acceleration profile.

				Such trajectories try to solve for the spline polynomials
				$\polynomial$ satisfying:

				\begin{equation}
					\arg\min_{\polynomial}
					\left\{
						\relweight
						\underbrace{
							\sum_{\indexi = 0}^{\cardinality{\setofpoints}}
								\gain_{\indexi}
								{%
									\left(
										\polynomial(\timesym_{\indexi}) -
										\point_{\indexi}
									\right)
								}^2
						}_{\text{error in approximation}}
						+
						(1 - \relweight)
						\underbrace{
							\int_{\timesym_0}^{\timesym_{\cardinality{\setofpoints}}}
								\ddot{\polynomial}^2
							\der \timesym
						}_{\text{curvature}}
					\right\}
					\label{eq:smoothing_cubic_splines_criterion}
				\end{equation}
				\todo{fix argmin}

				An algorithm based on linear algebra techniques to solve
				Equation~\ref{eq:smoothing_cubic_splines_criterion} can be found
				in \todo{add reference here}.

				The maximum approximation error can be guaranteed by performing
				a simple search technique, such as binary search, on the
				parameter $\relweight$.

	\subsection{Multi-Dimensional Trajectory Generation}%
	\label{sec:multi_dimensional_trajectory_generation}

		\todo{b splines, also see section 4.5 which was under one-dimensional}

	\subsection{Trajectory Scaling}%
	\label{sec:trajectory_scaling}

		Given a trajectory $\configuration(\timesym)$, one may perform several
		scaling techniques to ensure actuators do not exceed saturation
		constraints. 
